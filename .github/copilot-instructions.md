<!--
This file is auto-generated by an assistant. It contains focused, actionable guidance
for AI coding agents working in this repository. It's intentionally short and concrete.
-->

# Copilot instructions for contributors and AI agents


Repository snapshot (discoverable):
- Top-level working folder: `app/` with two main subprojects: `backend/` (FastAPI) and `frontend/` (Create React App + craco).

Quick start checklist (what I do first):
1. List `app/` to confirm files and manifests. Example (PowerShell):
   ```powershell
   Get-ChildItem -Path .\app -Force -Recurse -Depth 2
   ```
2. Auto-detect stack by looking at these files (already present here):
   - `backend/requirements.txt` -> Python FastAPI stack (FastAPI, uvicorn, motor, pydantic, pytest, linters)
   - `backend/server.py` -> Entrypoint for backend API, includes routers from `backend/routes/`
   - `frontend/package.json` -> Frontend is Create React App (uses `craco`); scripts: `start`, `build`, `test`.

Big-picture architecture (what to know):
- Backend: FastAPI application implemented in `backend/server.py`. It uses `motor` (async MongoDB client) and expects env vars `MONGO_URL` and `DB_NAME`. Route modules live in `backend/routes/` (examples: `ads.py`, `platforms.py`, `ai.py`) and export `router` objects that are included via `app.include_router(...)`.
- Frontend: Create React App augmented with `craco` in `frontend/`. The app uses React 19, Tailwind and numerous Radix UI packages. Start/build/test are driven by `craco` (see `frontend/package.json`).
- Data flow: backend persists data into MongoDB via Motor. Timestamps are serialized as ISO strings before inserting into MongoDB (see `server.py`), and route handlers commonly exclude MongoDB's `_id` or ignore it via Pydantic `ConfigDict(extra="ignore")`.

Key files to inspect (high signal):
- `backend/server.py` — main app, router mounting, CORS config, DB client lifecycle, example endpoints (`/api/status`)
- `backend/routes/*.py` — route modules that must export a `router` variable
- `backend/requirements.txt` — pinned deps and dev tools (pytest, black, isort, flake8, mypy)
- `frontend/package.json` — start/build/test scripts; dependency list and package manager (yarn v1)
- `frontend/src/` — React components and pages (UI lives under `frontend/src/components` and `frontend/src/pages`)

Concrete route patterns (examples from `backend/routes/`):
- Each route module defines an `APIRouter` with a `prefix` and registers endpoints. Example: `ads.py` uses `router = APIRouter(prefix="/api/ads", tags=["ads"])` and exports `router`.
- Database pattern: route modules call a local `get_db()` which creates an `AsyncIOMotorClient` from `MONGO_URL` and selects `DB_NAME`. Example usage: `db = get_db()` then `await db.ads.find({...}).to_list(1000)` or `await db.ads.insert_one(obj.dict())`.
- Error handling: endpoints raise `HTTPException` for 404s (e.g., ad/account not found).
- Route examples you can use when adding new routes:
  - Create resource: `@router.post('/', response_model=Model)` -> insert and return pydantic model
  - Read list: `@router.get('/', response_model=List[Model])` -> `await db.collection.find(query).to_list(1000)` then map to models
  - Read single: `@router.get('/{id}')` -> `await db.collection.find_one({'id': id})` else raise 404
  - Update: `await db.collection.update_one({'id': id}, {'$set': update_data})` then return updated document

Async & DB gotchas
- Motor client creation is cheap but clients should be closed on shutdown. `server.py` creates a client at top-level and closes on shutdown; route modules sometimes create their own client via `get_db()` — prefer reusing the main client when possible to avoid extra connections.
- When inserting documents, timestamps are converted to ISO strings before insert; when reading, endpoints convert ISO back to `datetime`.

If you add or modify route modules:
- Export a `router` APIRouter and include it in `backend/server.py` with `app.include_router(your_module.router)`.
- Add Pydantic models in `backend/models.py` and use `ConfigDict(extra='ignore')` when you want to safely ignore MongoDB `_id`.


Environment & secrets (how this repo expects secrets):
- Backend reads environment variables (loaded from a `.env` via `dotenv` in `server.py`). Required keys (look for usages in `server.py` and routes): `MONGO_URL`, `DB_NAME`, `CORS_ORIGINS`.
- Do not commit secrets. Use `.env` locally and document required vars in `README.md` when you add them.

Developer workflows (concrete commands)
- Backend (PowerShell):
  ```powershell
  # create venv, install, run dev server
  python -m venv .venv; .\.venv\Scripts\Activate.ps1
  pip install -r .\app\backend\requirements.txt
  # set .env or environment variables, then:
  uvicorn server:app --reload --host 0.0.0.0 --port 8000 --app-dir .\app\backend
  ```
- Frontend (PowerShell, uses yarn v1 as packageManager):
  ```powershell
  cd .\app\frontend
  yarn install
  ````instructions
  <!--
  Auto-generated guidance for AI coding agents working in this repository.
  Keep it short and concrete — reference the exact files and patterns used here.
  -->

  # Copilot instructions (merged, concise)

  Repository snapshot: main app lives in `app/` (two main subprojects):
  - `app/backend/` — FastAPI backend (async Motor/MongoDB, Pydantic models)
  - `app/frontend/` — Create React App (CRACO + Tailwind + shadcn/ui/Radix)

  Quick checks I do first:
  - open `app/backend/server.py`, `app/backend/routes/` and `app/backend/models.py` to learn API shape and DB patterns
  - open `app/frontend/package.json` and `craco.config.js` to see dev/start/build commands and path aliases

  Key patterns and files to reference:
  - API routers: each `backend/routes/*.py` exports `router = APIRouter(prefix=..., tags=[...])` and is included in `server.py` via `app.include_router(...)`.
  - DB access: many routes use a local `get_db()` that returns an AsyncIOMotorClient-selected DB. Prefer reusing the main client created in `server.py` to avoid extra connections.
  - Timestamps & IDs: documents often serialize datetimes to ISO strings before insert; Pydantic models commonly use `model_config = ConfigDict(extra="ignore")` to ignore MongoDB `_id`.
  - Frontend: CRA + CRACO; run scripts from `frontend/package.json` (yarn v1). UI uses shadcn/ui components and Tailwind.

  Developer workflows (PowerShell examples used in repo):
  - Backend dev:
    1) python -m venv .venv; .\.venv\Scripts\Activate.ps1
    2) pip install -r app/backend/requirements.txt
    3) set required env vars (e.g. MONGO_URL, DB_NAME, CORS_ORIGINS) or create `.env`
    4) uvicorn server:app --reload --host 0.0.0.0 --port 8000 --app-dir app/backend
  - Frontend dev:
    cd app/frontend && yarn install && yarn start

  Tests, linters, and quality tools:
  - Backend: pytest, black, isort, flake8, mypy (listed in `app/backend/requirements.txt`). Run `pytest` from `app/backend`.
  - Frontend: CRA test runner (`yarn test`), ESLint via devDependencies.

  Common tasks & gotchas:
  - When adding routes, export an `APIRouter` and include it in `server.py`.
  - Database reads often use `.to_list(1000)` and explicitly map to Pydantic models — follow existing examples in `routes/ads.py` and `routes/platforms.py`.
  - Close Motor clients on shutdown; prefer using the shared client in `server.py` rather than opening many clients.
  - Frontend webpack/postcss/tailwind behavior is controlled by `craco.config.js` — update it for build changes.

  Integration & deployment notes:
  - Dockerfiles present (Dockerfile.backend, Dockerfile.frontend) and `docker-compose.yml` at repo root — use these for containerized dev or production builds.
  - Environment variables are expected (backend loads `.env` via dotenv in `server.py`). Never commit secrets.

  Where to look for examples:
  - `app/backend/server.py` — app entry, CORS, DB client lifecycle
  - `app/backend/routes/ads.py`, `platforms.py`, `ai.py` — route/module patterns
  - `app/frontend/package.json`, `craco.config.js`, `frontend/src/` — frontend structure

  If you need to add CI: include workflows under `.github/workflows/` that run `pip install -r app/backend/requirements.txt && pytest` for backend and `yarn install && yarn test --ci` for frontend.

  If something is unclear (deployment target, DB connection details, CI expectations), stop and ask the maintainer — include which manifests you inspected and a short plan.

  -- End of file --
  ````

<!-- NEW CONCISE COPILOT INSTRUCTIONS (appended by assistant) -->
````instructions
<!--
Authoritative, concise guidance for AI agents working in this repo.
-->

<!--
Canonical Copilot instructions for this repository.
This file is the single-source-of-truth quick guide for AI coding agents and contributors.
Keep it short and concrete (20-50 lines).
-->

# Copilot instructions (canonical)

Repository layout (high signal):
- `app/backend/` — FastAPI backend (entry: `server.py`, routes: `routes/`, models: `models.py`). Uses Motor (async MongoDB).
- `app/frontend/` — Create React App with CRACO, Tailwind and shadcn/ui (entry: `frontend/package.json`, config: `craco.config.js`).

First checks (files to open):
- `app/backend/server.py` — router mounts, DB client lifecycle, env usage (`MONGO_URL`, `DB_NAME`, `CORS_ORIGINS`).
- `app/backend/routes/*` — router pattern examples (`ads.py`, `platforms.py`, `ai.py`).
- `app/frontend/package.json`, `craco.config.js` — dev/start/build scripts and webpack/tailwind config.

Project-specific conventions:
- Routes: each `backend/routes/*.py` exports an `APIRouter` and is included in `server.py` via `app.include_router(...)`.
- DB: prefer reusing the shared Motor client in `server.py`. Avoid creating duplicate Motor clients in route modules (`get_db()` patterns).
- Data: datetimes are serialized to ISO strings before insert; Pydantic models often use `model_config = ConfigDict(extra="ignore")` to ignore MongoDB `_id`.
- Query/list pattern: use `.to_list(1000)` then map to Pydantic models for lists/pagination.

Dev commands (PowerShell):
```powershell
# Backend
python -m venv .venv; .\.venv\Scripts\Activate.ps1
pip install -r app/backend/requirements.txt
uvicorn server:app --reload --app-dir app/backend

# Frontend
cd app/frontend
yarn install
yarn start
```

Tests & quality:
- Backend: `pytest` in `app/backend`; formatting via `black .`; linters available in `app/backend/requirements.txt` (flake8, mypy).
- Frontend: CRA test runner (`yarn test`); ESLint via devDependencies.

Deployment & infra notes:
- Dockerfiles (`Dockerfile.backend`, `Dockerfile.frontend`) and `docker-compose.yml` are provided for containerized runs.
- Backend reads `.env` via dotenv in `server.py` — do not commit secrets.

Where to look for examples:
- `app/backend/routes/ads.py`, `platforms.py`, `ai.py` — concrete router + DB usage
- `app/backend/server.py` — app entry, CORS, DB client lifecycle
- `app/frontend/package.json`, `craco.config.js`, `frontend/src/` — frontend structure and components

If you add CI: create `.github/workflows/` that run `pip install -r app/backend/requirements.txt && pytest` and `cd app/frontend && yarn install && yarn test --ci`.

If anything is unclear (deployment target, DB credentials, CI expectations), stop and ask a maintainer. Provide which manifests you inspected and a short plan for the proposed change.

- Dockerfiles (Dockerfile.backend, Dockerfile.frontend) and `docker-compose.yml` are present for containerized runs.
- Backend loads `.env` via dotenv in `server.py` — do not commit secrets.

Where to look for examples:
- `app/backend/routes/ads.py`, `platforms.py`, `ai.py` — router/db examples
- `app/backend/server.py` — include_router, client lifecycle, CORS
- `app/frontend/package.json`, `craco.config.js`, `frontend/src/` — frontend structure and components

If you need to add CI: create `.github/workflows/` entries that run `pip install -r app/backend/requirements.txt && pytest` and `cd app/frontend && yarn install && yarn test --ci`.

If anything is unclear (deployment target, DB credentials, CI requirements), stop and ask a maintainer — include which manifests you inspected and a short plan for the change.

-- End of file --
````
