#!/usr/bin/env bash
#
# Pre-commit hook to check for legacy brand tokens
#
# This hook runs the check_no_legacy_brand.py script to prevent
# accidentally committing old internal names or deprecated brand tokens.
#
# To enable this hook:
#   git config core.hooksPath .githooks
#
# Note: If Python 3 is not installed, the hook will warn but allow the commit.
# To enforce strict checking, ensure Python 3 is installed on all development machines.
#

# Get the repository root directory
REPO_ROOT="$(git rev-parse --show-toplevel)"

# Path to the checker script
CHECKER_SCRIPT="${REPO_ROOT}/app/scripts/check_no_legacy_brand.py"

# Check if Python 3 is available
if ! command -v python3 &> /dev/null; then
    echo "⚠️  WARNING: python3 not found. Legacy brand token check SKIPPED." >&2
    echo "   Install Python 3 to enable this protection." >&2
    exit 0
fi

# Check if the script exists
if [ ! -f "$CHECKER_SCRIPT" ]; then
    echo "⚠️  WARNING: check_no_legacy_brand.py not found. Legacy brand token check SKIPPED." >&2
    exit 0
fi

# Run the checker on staged files
python3 "$CHECKER_SCRIPT" --staged

# Exit with the same exit code as the checker
exit $?
